<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>9999-in-1 Ultimate Replica</title>
    <style>
        :root { --lcd-on: #1a1a1a; --lcd-off: #8b957e; --case: #f1c40f; }
        body { background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: 'Courier New', monospace; overflow: hidden; touch-action: none; }
        
        #handheld { background: var(--case); padding: 30px; border-radius: 20px 20px 100px 100px; border: 6px solid #d4ac0d; box-shadow: 15px 15px 0px #000; width: 380px; position: relative; }
        
        #screen-border { background: var(--lcd-off); padding: 12px; border: 12px solid #333; display: flex; box-shadow: inset 0 0 15px rgba(0,0,0,0.4); border-radius: 5px; }
        canvas { image-rendering: pixelated; background: transparent; }
        
        .side { flex: 1; padding-left: 12px; color: var(--lcd-on); font-weight: bold; font-size: 11px; display: flex; flex-direction: column; max-width: 120px; }
        .stat-val { font-size: 22px; display: block; margin-bottom: 8px; }

        .main-controls { margin-top: 40px; display: flex; justify-content: space-between; align-items: center; padding: 0 10px; }

        .d-pad { display: grid; grid-template-columns: repeat(3, 50px); grid-template-rows: repeat(3, 50px); }
        .btn { background: #c0392b; border: none; border-radius: 50%; color: #fff; cursor: pointer; box-shadow: 0 5px #7b241c; font-weight: bold; position: relative; -webkit-tap-highlight-color: transparent; }
        .btn:active { transform: translateY(3px); box-shadow: 0 2px #7b241c; }
        
        .btn-up { grid-column: 2; grid-row: 1; }
        .btn-left { grid-column: 1; grid-row: 2; }
        .btn-right { grid-column: 3; grid-row: 2; }
        .btn-down { grid-column: 2; grid-row: 3; }

        .action-zone { display: flex; flex-direction: column; align-items: center; }
        .btn-rot { width: 95px; height: 95px; background: #2c3e50; box-shadow: 0 6px #1a252f; font-size: 14px; border-radius: 50%; }
        .btn-rot:active { box-shadow: 0 2px #1a252f; }

        .sys-row { display: flex; justify-content: center; gap: 20px; margin-top: 25px; }
        .btn-sys { width: 80px; height: 35px; border-radius: 10px; font-size: 10px; background: #444; box-shadow: 0 4px #222; }
        .btn-start { background: #1e8449; box-shadow: 0 4px #145a32; width: 110px; }
        
        /* Adjusted game title style for longer words */
        #gm { margin: 0; font-size: 18px; line-height: 1.1; word-wrap: break-word; text-transform: uppercase; }
    </style>
</head>
<body>

<div id="handheld">
    <div id="screen-border">
        <canvas id="lcd" width="160" height="320"></canvas>
        <div class="side">
            SCORE<br><span id="sc" class="stat-val">00000</span>
            GAME<br><div id="gm" style="margin-bottom: 10px;">BRICK</div>
            LIVES<br><span id="lv" class="stat-val">--</span>
        </div>
    </div>

    <div class="main-controls">
        <div class="d-pad">
            <button class="btn btn-up" onclick="input('UP')">▲</button>
            <button class="btn btn-left" onclick="input('LEFT')">◀</button>
            <button class="btn btn-right" onclick="input('RIGHT')">▶</button>
            <button class="btn btn-down" onclick="input('DOWN')">▼</button>
        </div>
        <div class="action-zone">
            <button class="btn btn-rot" onclick="input('ROTATE')">ROTATE<br>FIRE</button>
        </div>
    </div>

    <div class="sys-row">
        <button class="btn btn-sys" onclick="location.reload()">RESET (R)</button>
        <button class="btn btn-sys btn-start" onclick="toggleStart()">START (CTRL)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('lcd'), ctx = canvas.getContext('2d');
    const ROWS = 20, COLS = 10, S = 16;
    let mode = 'MENU', gameID = 0, score = 0, tick = 0, lives = 4, paused = false;
    
    // Updated game list with Titles
    const games = ['BRICK', 'TANKS', 'RACING', 'SNAKE', 'BREAK'];

    let grid = Array.from({length: ROWS}, () => Array(COLS).fill(0));
    const SHAPES = [[[1,1,1,1]], [[1,1],[1,1]], [[0,1,0],[1,1,1]], [[1,1,0],[0,1,1]]];
    
    let piece, carX, enemies = [], bullets = [], snake = [], dir = {x:0, y:-1}, food = {}, ball = {}, playerX = 3, flash = 0;

    window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowUp') input('UP');
        if (e.key === 'ArrowDown') input('DOWN');
        if (e.key === 'ArrowLeft') input('LEFT');
        if (e.key === 'ArrowRight') input('RIGHT');
        if (e.key === ' ') { e.preventDefault(); input('ROTATE'); }
        if (e.key === 'Control') { e.preventDefault(); toggleStart(); }
        if (e.key === 'r' || e.key === 'R') location.reload();
    });

    function drawPx(x, y, on) {
        ctx.fillStyle = on ? "#1a1a1a" : "rgba(0,0,0,0.06)";
        ctx.fillRect(x*S+1, y*S+1, S-2, S-2);
        ctx.strokeStyle = on ? "#1a1a1a" : "rgba(0,0,0,0.03)";
        ctx.strokeRect(x*S+3, y*S+3, S-6, S-6);
    }

    function drawSprite(x, y, sprite) {
        sprite.forEach((r, dy) => r.forEach((v, dx) => { 
            if(v && y+dy >= 0 && y+dy < ROWS && x+dx >= 0 && x+dx < COLS) drawPx(x+dx, y+dy, 1); 
        }));
    }

    function collide(px, py, s) {
        return s.some((r, dy) => r.some((v, dx) => {
            let nx = px + dx, ny = py + dy;
            return v && (nx < 0 || nx >= COLS || ny >= ROWS || (ny >= 0 && grid[ny][nx]));
        }));
    }

    function loseLife() {
        if (games[gameID] === 'BRICK') { mode = 'MENU'; return; }
        lives--;
        if (lives <= 0) mode = 'MENU'; else resetPositions();
    }

    function resetPositions() {
        enemies = []; bullets = []; flash = 0;
        const g = games[gameID];
        if(g === 'TANKS') enemies = [{x: 1, y: 1}, {x: 7, y: 1}];
        if(g === 'RACING') carX = 1;
        if(g === 'SNAKE') { snake = [{x:5,y:10},{x:5,y:11}]; dir = {x:0,y:-1}; }
        if(g === 'BREAK') { playerX = 3; ball = {x:5, y:15, dx:0.5, dy:-0.5}; }
    }

    function toggleStart() {
        if (mode === 'MENU') start();
        else paused = !paused;
    }

    function update() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(let y=0; y<ROWS; y++) for(let x=0; x<COLS; x++) drawPx(x, y, grid[y][x]);

        if(mode === 'MENU') {
            ctx.fillStyle = "#1a1a1a"; ctx.font = "bold 60px Courier New"; ctx.textAlign = "center";
            // Drawing the first letter of the game on the LCD as the icon
            ctx.fillText(games[gameID].charAt(0), canvas.width/2, 180);
            document.getElementById('lv').innerText = "--";
        } else if (paused) {
            ctx.fillStyle = "#1a1a1a"; ctx.font = "20px Courier New"; ctx.textAlign = "center";
            ctx.fillText("PAUSED", canvas.width/2, 160);
        } else {
            tick++;
            const g = games[gameID];
            document.getElementById('lv').innerText = (g === 'BRICK') ? "--" : lives;

            if (g === 'BRICK') { 
                if(tick % 20 === 0) {
                    piece.y++;
                    if(collide(piece.x, piece.y, piece.shape)) {
                        piece.y--;
                        piece.shape.forEach((r, dy) => r.forEach((v, dx) => { if(v) grid[piece.y+dy][piece.x+dx] = 1; }));
                        grid = grid.filter(r => !r.every(v => v));
                        while(grid.length < ROWS) { grid.unshift(Array(COLS).fill(0)); score += 100; }
                        piece = { x: 3, y: 0, shape: SHAPES[Math.floor(Math.random()*SHAPES.length)] };
                        if(collide(piece.x, piece.y, piece.shape)) mode = 'MENU';
                    }
                }
                drawSprite(piece.x, piece.y, piece.shape);
            } else if (g === 'TANKS') {
                if(tick % 3 === 0) {
                    bullets.forEach((b, i) => {
                        b.y += b.v;
                        if(b.y < 0 || b.y >= ROWS) bullets.splice(i, 1);
                        else if(b.v < 0 && enemies.some(e => b.x >= e.x && b.x < e.x+3 && b.y >= e.y && b.y < e.y+3)) {
                            enemies = enemies.filter(e => !(b.x >= e.x && b.x < e.x+3 && b.y >= e.y && b.y < e.y+3));
                            bullets.splice(i, 1); score += 100;
                            setTimeout(() => { if(mode==='PLAYING') enemies.push({x: Math.floor(Math.random()*7), y: 1})}, 2000);
                        } else if(b.v > 0 && b.x >= playerX && b.x < playerX+3 && b.y >= 17) { bullets.splice(i,1); loseLife(); }
                    });
                }
                if(tick % 40 === 0) {
                    enemies.forEach(e => {
                        if(Math.random() > 0.7) { e.x += (Math.random() > 0.5 ? 1 : -1); e.x = Math.max(0, Math.min(e.x, COLS-3)); }
                        if(Math.random() > 0.95) bullets.push({x: e.x+1, y: e.y+3, v: 1});
                    });
                }
                drawSprite(playerX, 17, [[0,1,0],[1,1,1],[1,0,1]]);
                enemies.forEach(e => drawSprite(e.x, e.y, [[1,0,1],[1,1,1],[0,1,0]]));
                bullets.forEach(b => drawPx(b.x, b.y, 1));
                if(flash > 0) { drawPx(playerX+1, 16, 1); flash--; }
            } else if (g === 'RACING') {
                if(tick % 5 === 0) {
                    enemies.forEach(e => e.y++);
                    enemies = enemies.filter(e => e.y < ROWS);
                    let lastY = enemies.length ? Math.min(...enemies.map(e => e.y)) : 100;
                    if(lastY > 6 && Math.random() > 0.7) enemies.push({x: Math.random() > 0.5 ? 1 : 6, y: -4});
                }
                drawSprite(carX, 16, [[0,1,0],[1,1,1],[0,1,0],[1,1,1]]);
                enemies.forEach(e => { drawSprite(e.x, e.y, [[0,1,0],[1,1,1],[0,1,0],[1,1,1]]); if(e.x === carX && Math.abs(e.y - 16) < 4) loseLife(); });
                for(let i=0; i<ROWS; i++) if((i+tick)%4<2){ drawPx(0,i,1); drawPx(9,i,1); }
            } else if (g === 'SNAKE') {
                if(tick % 10 === 0) {
                    let h = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
                    if(h.x<0||h.x>=COLS||h.y<0||h.y>=ROWS||snake.some(s=>s.x===h.x&&s.y===h.y)) loseLife();
                    else {
                        snake.unshift(h);
                        if(h.x === food.x && h.y === food.y) { score += 50; food = {x:Math.floor(Math.random()*COLS), y:Math.floor(Math.random()*ROWS)}; }
                        else snake.pop();
                    }
                }
                snake.forEach(p => drawPx(p.x, p.y, 1)); drawPx(food.x, food.y, 1);
            } else if (g === 'BREAK') {
                if(tick % 4 === 0) {
                    ball.x += ball.dx; ball.y += ball.dy;
                    if(ball.x <= 0 || ball.x >= COLS-1) ball.dx *= -1;
                    if(ball.y <= 0) ball.dy *= -1;
                    if(ball.y >= ROWS-1) loseLife();
                    if(ball.y >= 18 && ball.x >= playerX && ball.x < playerX+3) ball.dy *= -1;
                    let bx = Math.round(ball.x), by = Math.round(ball.y);
                    if(grid[by] && grid[by][bx]) { grid[by][bx] = 0; ball.dy *= -1; score += 20; }
                }
                for(let i=0; i<3; i++) drawPx(playerX+i, 19, 1);
                drawPx(Math.round(ball.x), Math.round(ball.y), 1);
            }
        }
        document.getElementById('sc').innerText = score.toString().padStart(5, '0');
        requestAnimationFrame(update);
    }

    function input(k) {
        if(mode === 'MENU') {
            if(k === 'LEFT' || k === 'UP') gameID = (gameID + 4) % 5;
            if(k === 'RIGHT' || k === 'DOWN') gameID = (gameID + 1) % 5;
            document.getElementById('gm').innerText = games[gameID];
            return;
        }
        if (paused) return;
        const g = games[gameID];
        if(g === 'BRICK') {
            if(k === 'LEFT' && !collide(piece.x-1, piece.y, piece.shape)) piece.x--;
            if(k === 'RIGHT' && !collide(piece.x+1, piece.y, piece.shape)) piece.x++;
            if(k === 'DOWN' && !collide(piece.x, piece.y+1, piece.shape)) piece.y++;
            if(k === 'ROTATE') { let r = piece.shape[0].map((_, i) => piece.shape.map(row => row[i]).reverse()); if(!collide(piece.x, piece.y, r)) piece.shape = r; }
        } else if(g === 'TANKS' || g === 'BREAK') {
            if(k === 'LEFT' && playerX > 0) playerX--;
            if(k === 'RIGHT' && playerX < COLS-3) playerX++;
            if(k === 'ROTATE' && g === 'TANKS' && !bullets.some(b => b.v < 0)) { bullets.push({x: playerX+1, y: 16, v: -1}); flash = 3; }
        } else if(g === 'RACING') {
            if(k === 'LEFT') carX = 1; if(k === 'RIGHT') carX = 6;
        } else if(g === 'SNAKE') {
            if(k === 'UP' && dir.y === 0) dir = {x:0, y:-1}; if(k === 'DOWN' && dir.y === 0) dir = {x:0, y:1};
            if(k === 'LEFT' && dir.x === 0) dir = {x:-1, y:0}; if(k === 'RIGHT' && dir.x === 0) dir = {x:1, y:0};
        }
    }

    function start() {
        mode = 'PLAYING'; score = 0; tick = 0; lives = 4; paused = false;
        grid = Array.from({length: ROWS}, () => Array(COLS).fill(0));
        resetPositions();
        if(games[gameID] === 'BRICK') piece = { x: 3, y: 0, shape: SHAPES[0] };
        if(games[gameID] === 'SNAKE') food = {x:2,y:2};
        if(games[gameID] === 'BREAK') { for(let y=2; y<6; y++) for(let x=0; x<COLS; x++) grid[y][x] = 1; }
    }
    update();
</script>
</body>
</html>
