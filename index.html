<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: #f0f0f0; }
        .loader { border: 4px solid #ccc; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="loader"></div>
    <p id="status">Verifying environment...</p>

    <div id="ad-bait" class="ad-container adsbox pub_300x250" style="position: absolute; left: -9999px;">&nbsp;</div>

    <script>
        const MY_GAMES_SITE = "/home.html";
        const SAFE_SITE = "https://www.britannica.com";

        async function checkEnvironment() {
            let isManaged = false;

            // 1. Hardware Detection (ChromeOS)
            if (/\bCrOS\b/.test(navigator.userAgent)) isManaged = true;

            // 2. Behavioral Detection (Ad-blockers/Filters)
            const bait = document.getElementById('ad-bait');
            if (!bait || bait.offsetParent === null || bait.offsetHeight === 0) {
                isManaged = true;
            }

            // 3. Extension ID Probing
            // Added Linewize (Qoria) and other common school filters
            const filterExtensions = [
                'ifinpabiejbjobcphhaomiifjibpkjlf', // Linewize Connect / Qoria
                'haldlgldplgnggkjaafhelgiaglafanh', // GoGuardian
                'ckecmkbnoanpgplccmnoikfmpcdladkc', // Securly (Chromebook)
                'kfiocjonplkilcjfgabfngiddebalkod'  // Securly (Windows/Mac)
            ];

            for (let id of filterExtensions) {
                try {
                    // We try to fetch the manifest file of the extension
                    let res = await fetch(`chrome-extension://${id}/manifest.json`);
                    if (res.ok) {
                        isManaged = true;
                        break;
                    }
                } catch (e) { /* Extension not accessible or not present */ }
            }

            // Final Redirect
            if (isManaged) {
                window.location.href = MY_GAMES_SITE;
            } else {
                window.location.href = SAFE_SITE;
            }
        }

        // Delay execution slightly to allow extensions to load/interact with page
        setTimeout(checkEnvironment, 1000);
    </script>
</body>
</html>
